<!DOCTYPE html>
<html lang="tr">
<head>
    <!-- Tüm stil tanımları aynı -->
    <!-- ... (önceki tüm CSS kodu) ... -->
</head>
<body>
    <!-- Tüm HTML yapısı aynı -->
    <!-- ... (önceki tüm HTML kodu) ... -->

    <script>
        // GÜNCELLENMİŞ JAVASCRIPT KODU
        let users = [
            {
                id: '1',
                name: 'Demo Kullanıcı',
                email: 'test@example.com',
                phone: '5551234567',
                password: '123456',
                balance: 10000,
                createdAt: new Date().toISOString()
            }
        ];
        
        let cards = [
            {
                id: '1',
                userId: '1',
                number: '4111111111111111',
                displayNumber: '**** **** **** 1111',
                holder: 'DEMO KULLANICI',
                expiry: '12/25',
                cvc: '123',
                type: 'standard',
                balance: 5000,
                createdAt: new Date().toISOString()
            }
        ];
        
        let transactions = [
            {
                id: '1',
                userId: '1',
                description: 'Hoş geldiniz bonusu',
                amount: 1000,
                balance: 1000,
                date: new Date().toISOString()
            }
        ];
        
        let currentUser = null;
        const products = [
            { id: 1, name: "HLgame(1 tur)", price: 100, description: "1 tur HL oyun deneyimi" },
            { id: 2, name: "Tezgah Stars Ön Bilet", price: 10000, description: "Tezgah Stars etkinliği ön bilet" },
            { id: 3, name: "Tezgah Stars Ön Bilet Pro Açılı", price: 15000, description: "Tezgah Stars etkinliği VIP ön bilet" }
        ];
        
        const cardTypes = {
            standard: { name: "Standart Kart", balance: 5000 },
            gold: { name: "Gold Kart", balance: 15000 },
            platinum: { name: "Platinum Kart", balance: 30000 }
        };

        // DOM ELEMENTLERİ
        const loginBtn = document.getElementById('loginBtn');
        const registerBtn = document.getElementById('registerBtn');
        const loginModal = document.getElementById('loginModal');
        const registerModal = document.getElementById('registerModal');
        const addCardModal = document.getElementById('addCardModal');
        const buyProductModal = document.getElementById('buyProductModal');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const addCardForm = document.getElementById('addCardForm');
        const buyProductForm = document.getElementById('buyProductForm');
        const addCardBtn = document.getElementById('addCardBtn');
        const dashboard = document.getElementById('dashboard');
        const publicContent = document.getElementById('publicContent');
        const cardList = document.getElementById('cardList');
        const transactionsBody = document.getElementById('transactionsBody');
        const productsGrid = document.getElementById('productsGrid');
        const userName = document.getElementById('userName');
        const userBalance = document.getElementById('userBalance');
        const logoutBtn = document.getElementById('logoutBtn');

        // EVENT LİSTENER'LAR
        document.querySelectorAll('.close-modal').forEach(btn => {
            btn.addEventListener('click', () => {
                btn.closest('.modal').style.display = 'none';
            });
        });

        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });

        loginBtn.addEventListener('click', () => loginModal.style.display = 'flex');
        registerBtn.addEventListener('click', () => registerModal.style.display = 'flex');
        document.getElementById('heroRegisterBtn').addEventListener('click', (e) => {
            e.preventDefault();
            registerModal.style.display = 'flex';
        });

        // GİRİŞ İŞLEMLERİ
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const user = users.find(u => u.email === email && u.password === password);
            if (user) {
                currentUser = user;
                updateUIAfterLogin();
                loginModal.style.display = 'none';
                loginForm.reset();
            } else {
                alert('Geçersiz bilgiler!');
            }
        });

        // KAYIT İŞLEMLERİ
        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('registerEmail').value;
            
            if (users.some(u => u.email === email)) {
                alert('Bu e-posta zaten kullanılıyor!');
                return;
            }
            
            const newUser = {
                id: Date.now().toString(),
                name: document.getElementById('registerName').value,
                email: email,
                phone: document.getElementById('registerPhone').value,
                password: document.getElementById('registerPassword').value,
                balance: 1000,
                createdAt: new Date().toISOString()
            };
            
            users.push(newUser);
            currentUser = newUser;
            addTransaction(currentUser.id, 'Hoş geldiniz bonusu', 1000, 1000);
            updateUIAfterLogin();
            registerModal.style.display = 'none';
            registerForm.reset();
            alert('Kayıt başarılı! 1000 HL bonus yüklendi.');
        });

        // KART İŞLEMLERİ
        addCardBtn.addEventListener('click', () => addCardModal.style.display = 'flex');
        
        addCardForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '');
            
            if (cards.some(c => c.number === cardNumber)) {
                alert('Bu kart zaten kayıtlı!');
                return;
            }
            
            const newCard = {
                id: Date.now().toString(),
                userId: currentUser.id,
                number: cardNumber,
                displayNumber: '**** **** **** ' + cardNumber.slice(-4),
                holder: document.getElementById('cardHolder').value,
                expiry: document.getElementById('cardExpiry').value,
                cvc: document.getElementById('cardCvc').value,
                type: document.getElementById('cardType').value,
                balance: cardTypes[document.getElementById('cardType').value].balance,
                createdAt: new Date().toISOString()
            };
            
            cards.push(newCard);
            renderUserCards();
            addCardModal.style.display = 'none';
            addCardForm.reset();
        });

        // ÜRÜN SATIN ALMA
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('buy-btn')) {
                const productId = parseInt(e.target.dataset.productId);
                const product = products.find(p => p.id === productId);
                
                document.getElementById('buyProductInfo').innerHTML = `
                    <h3>${product.name}</h3>
                    <p>${product.description}</p>
                    <p><strong>Fiyat: ${product.price} HL</strong></p>
                `;
                
                const select = document.getElementById('paymentCard');
                select.innerHTML = '';
                cards.filter(c => c.userId === currentUser.id).forEach(card => {
                    const option = document.createElement('option');
                    option.value = card.id;
                    option.textContent = `${cardTypes[card.type].name} (${card.displayNumber}) - ${card.balance} HL`;
                    select.appendChild(option);
                });
                
                buyProductForm.dataset.productId = productId;
                buyProductModal.style.display = 'flex';
            }
        });

        buyProductForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const productId = parseInt(e.target.dataset.productId);
            const product = products.find(p => p.id === productId);
            const cardId = document.getElementById('paymentCard').value;
            const card = cards.find(c => c.id === cardId);
            
            if (card.balance >= product.price) {
                card.balance -= product.price;
                currentUser.balance -= product.price;
                addTransaction(currentUser.id, `${product.name} satın alındı`, -product.price, currentUser.balance);
                renderUserCards();
                userBalance.textContent = currentUser.balance;
                buyProductModal.style.display = 'none';
                alert('Satın alma başarılı!');
            } else {
                alert('Yetersiz bakiye!');
            }
        });

        // ÇIKIŞ İŞLEMİ
        logoutBtn.addEventListener('click', () => {
            currentUser = null;
            dashboard.style.display = 'none';
            publicContent.style.display = 'block';
        });

        // YARDIMCI FONKSİYONLAR
        function updateUIAfterLogin() {
            publicContent.style.display = 'none';
            dashboard.style.display = 'block';
            userName.textContent = currentUser.name;
            userBalance.textContent = currentUser.balance;
            renderUserCards();
            renderTransactions();
            renderProducts();
        }

        function renderUserCards() {
            cardList.innerHTML = '';
            cards.filter(c => c.userId === currentUser.id).forEach(card => {
                const cardEl = document.createElement('div');
                cardEl.className = `bank-card ${card.type}`;
                cardEl.innerHTML = `
                    <div class="card-type">${cardTypes[card.type].name}</div>
                    <div class="card-number">${card.displayNumber}</div>
                    <div class="card-details">
                        <div>${card.holder}</div>
                        <div>${card.expiry}</div>
                    </div>
                `;
                cardList.appendChild(cardEl);
            });
        }

        function renderTransactions() {
            transactionsBody.innerHTML = '';
            transactions
                .filter(t => t.userId === currentUser.id)
                .sort((a,b) => new Date(b.date) - new Date(a.date))
                .forEach(t => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${new Date(t.date).toLocaleString()}</td>
                        <td>${t.description}</td>
                        <td class="transaction-amount ${t.amount >= 0 ? 'positive' : 'negative'}">
                            ${t.amount >= 0 ? '+' : ''}${t.amount} HL
                        </td>
                        <td>${t.balance} HL</td>
                    `;
                    transactionsBody.appendChild(row);
                });
        }

        function renderProducts() {
            productsGrid.innerHTML = '';
            products.forEach(product => {
                const productEl = document.createElement('div');
                productEl.className = 'product-card';
                productEl.innerHTML = `
                    <div class="product-image">
                        <i class="fas fa-shopping-bag"></i>
                    </div>
                    <div class="product-info">
                        <h3 class="product-title">${product.name}</h3>
                        <p>${product.description}</p>
                        <div class="product-price">${product.price} HL</div>
                        <button class="buy-btn" data-product-id="${product.id}">Satın Al</button>
                    </div>
                `;
                productsGrid.appendChild(productEl);
            });
        }

        function addTransaction(userId, description, amount, balance) {
            const transaction = {
                id: Date.now().toString(),
                userId,
                description,
                amount,
                balance,
                date: new Date().toISOString()
            };
            transactions.push(transaction);
            renderTransactions();
        }

        // SAYFA YÜKLENDİĞİNDE
        document.addEventListener('DOMContentLoaded', () => {
            renderProducts();
        });
    </script>
</body>
</html>
